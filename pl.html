<html>
<head>
    <meta charset="utf-8"/>
    <title>900_插件注入</title>
    <link id="css" rel="stylesheet prefetch" href="css/style.css">
    <script>
            // if(document.cookie.indexOf('kex=0') >= 0){
            //     document.cookie = 'kex=1';
            //     document.location.href = '.';
            // }
            // else
            //     document.cookie = 'kex=0';
        var pl_name = getHashParams()['pl'];
        run_PL(pl_name);

        async function getfile(path) {
            var file = await fetch("./pl/"+path+".bin");
            if(file.ok){
                data = await file.arrayBuffer();
                return data;
            }
            return ''
        }
        function getHashParams()
        {
            var ans = {};
            var p = document.location.hash.substr(1).split("&");
            for(var i = 0; i < p.length; i++)
            {
                var kv = p[i].split('=');
                var k = kv.shift();
                ans[k] = decodeURIComponent(kv.join('='));
            }
            return ans;
        }

        const sleep = (timeountMS) => new Promise((resolve) => {
            setTimeout(resolve, timeountMS);
        });
       
        async function run_PL(pl_name){
            var payload = await getfile(pl_name);
            pl_pass = await new Response(payload).arrayBuffer();
            var tmp = new Uint8Array(pl_pass.byteLength);
            tmp.set(new Uint8Array(payload), 0);
            window.pl_pass = new Uint32Array(tmp);
        }

        window.parent.msgs.innerHTML="正在执行 漏洞利用";
        once=async function(){
        await sleep(1000);
        poc();
        }
        window.parent.msgs.innerHTML="执行完成";

    </script>
    <script src="./common/int64.js" defer></script>
    <script src="./common/rop.js" defer></script>
    <script src="./common/kexploit.js" defer></script>
    <script src="./common/webkit.js" defer></script>
</head>
<body>
    <!-- <h2 id="msgs" style="min-height:38px;margin-top:10%;font-size: 36px;" >正在执行 漏洞利用</h2> -->
<!--     <h4>推荐使用 USB2.0 小容量U盘使用.</h4>
    <h4> 不推荐 离线缓存使用. </h4> -->
<!--     <div style="margin:0px;width=70%;display:inline-block;">
    </div> -->

</body>
</html>

